<!-- Encabezado y botón agregar -->
<div class="flex justify-between items-center mb-4">
    <h1 class="text-xl font-bold">Clientes</h1>
</div>
<!-- Tabla -->
<app-table [headers]="columnas" [displayedColumns]="campos" [rows]="clientes()" [actions]="acciones"
    [enableSearch]="true" [showNuevo]="true" [nuevoLabel]="'Nuevo cliente'" [pageSize]="10"
    (nuevoClick)="abrirFormulario()" (actionClick)="manejarAccion($event)"></app-table>


<!-- Modal de detalle -->
@if (clienteSeleccionado) {
<app-table-detail [item]="clienteSeleccionado" title="Detalle del Cliente" entity="cliente" (cerrar)="cerrarDetalle()">

    <!-- 🔗 Sección adicional: pólizas asociadas -->
    @if (polizasDelCliente().length > 0) {
    <div detalle-extra class="mt-4">
        <h2 class="mb-2 text-sm text-gray-500 font-medium uppercase">Pólizas asociadas</h2>

        <div class="space-y-2">
            @for (poliza of polizasDelCliente(); track poliza.id) {
            <div class="p-3 bg-gray-50 rounded-md border text-sm text-gray-800">
                <div class="font-semibold text-gray-600">{{ poliza.tipoSeguro }}</div>
                <div>Inicio: {{ poliza.fechaInicio }}</div>
                <div>Vencimiento: {{ poliza.fechaVencimiento }}</div>
                <div>Estado: {{ poliza.estado }}</div>
            </div>
            }
        </div>
    </div>
    } @else {
    <div detalle-extra class="mt-4 text-sm text-gray-400 italic">
        Este cliente no tiene pólizas asociadas.
    </div>
    }

</app-table-detail>
}


<!-- Modal de formulario -->
@if (formularioVisible) {
<app-table-form [title]="modoEdicion ? 'Editar Cliente' : 'Nuevo Cliente'"
    [textGuardar]="modoEdicion ? 'Guardar cambios' : 'Crear cliente'" [textCancelar]="'Cancelar'" [showGuardar]="true"
    [disableGuardar]="clienteForm.invalid" [form]="clienteForm" [fields]="formFields" (cerrar)="cerrarFormulario()"
    (guardar)="guardarFormulario()" />

}
<!-- Confirmación de eliminación -->
@if(clienteParaEliminar){
<app-table-confirm title="¿Eliminar cliente?"
    [message]="'¿Estás seguro de eliminar a ' + clienteParaEliminar.nombre + '?'" textCancelar="Cancelar"
    textConfirmar="Eliminar" (cancelar)="cancelarEliminacion()" (confirmar)="confirmarEliminacion()" />
}